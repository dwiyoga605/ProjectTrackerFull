{"version":3,"file":"popup-controller.js","sourceRoot":"","sources":["../../../../src/modules/popup/classes/popup-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import { ComponentRef, ElementRef, HostListener, OnDestroy } from \"@angular/core\";\r\nimport { SuiComponentFactory } from \"../../../misc/util\";\r\nimport { PopupConfig, PopupTrigger } from \"./popup-config\";\r\nimport { SuiPopup } from \"../components/popup\";\r\nimport { IPopupLifecycle } from \"./popup-lifecycle\";\r\n\r\nexport interface IPopup {\r\n    open():void;\r\n    close():void;\r\n    toggle():void;\r\n}\r\n\r\nexport abstract class SuiPopupController implements IPopup, OnDestroy {\r\n    // Stores reference to generated popup component.\r\n    private _componentRef:ComponentRef<SuiPopup>;\r\n\r\n    // Returns generated popup instance.\r\n    public get popup():SuiPopup {\r\n        // Use non-null assertion as we only access this when a popup exists.\r\n        return this._componentRef.instance;\r\n    }\r\n\r\n    // `setTimeout` timer pointer for delayed popup open.\r\n    private _openingTimeout:number;\r\n\r\n    constructor(protected _element:ElementRef,\r\n                protected _componentFactory:SuiComponentFactory,\r\n                config:PopupConfig) {\r\n\r\n        // Generate a new SuiPopup component and attach it to the application view.\r\n        this._componentRef = this._componentFactory.createComponent(SuiPopup);\r\n\r\n        // Configure popup with provided config.\r\n        this.popup.config = config;\r\n\r\n        // When the popup is closed (onClose fires on animation complete),\r\n        this.popup.onClose.subscribe(() => {\r\n            this._componentRef.instance.positioningService.destroy();\r\n            this._componentFactory.detachFromApplication(this._componentRef);\r\n        });\r\n    }\r\n\r\n    public openDelayed():void {\r\n        // Cancel the opening timer.\r\n        clearTimeout(this._openingTimeout);\r\n\r\n        // Start the popup opening after the specified delay interval.\r\n        this._openingTimeout = window.setTimeout(() => this.open(), this.popup.config.delay);\r\n    }\r\n\r\n    public open():void {\r\n        // If there is a template, inject it into the view.\r\n        if (this.popup.config.template) {\r\n            this.popup.templateSibling.clear();\r\n\r\n            this._componentFactory.createView(this.popup.templateSibling, this.popup.config.template, {\r\n                $implicit: this.popup\r\n            });\r\n        }\r\n\r\n        // Detach & reattach the generated component to the current application.\r\n        this._componentFactory.detachFromApplication(this._componentRef);\r\n        this._componentFactory.attachToApplication(this._componentRef);\r\n\r\n        // Move the generated element to the body to avoid any positioning issues.\r\n        this._componentFactory.moveToDocumentBody(this._componentRef);\r\n\r\n        // Attach a reference to the anchor element. We do it here because IE11 loves to complain.\r\n        this.popup.anchor = this._element;\r\n\r\n        // Start popup open transition.\r\n        this.popup.open();\r\n\r\n        // Call lifecyle hook\r\n        const lifecycle = (this as IPopupLifecycle).popupOnOpen;\r\n        if (lifecycle) {\r\n            lifecycle.call(this);\r\n        }\r\n    }\r\n\r\n    public close():void {\r\n        // Cancel the opening timer to stop the popup opening after close has been called.\r\n        clearTimeout(this._openingTimeout);\r\n\r\n        if (this._componentRef) {\r\n            // Start popup close transition.\r\n            this.popup.close();\r\n        }\r\n\r\n        // Call lifecyle hook\r\n        const lifecycle = (this as IPopupLifecycle).popupOnClose;\r\n        if (lifecycle) {\r\n            lifecycle.call(this);\r\n        }\r\n    }\r\n\r\n    public toggleDelayed():void {\r\n        // If the popup hasn't been created, or it has but it isn't currently open, open the popup.\r\n        if (!this._componentRef || (this._componentRef && !this.popup.isOpen)) {\r\n            return this.openDelayed();\r\n        }\r\n\r\n        // O'wise, close it.\r\n        return this.close();\r\n    }\r\n\r\n    public toggle():void {\r\n        // If the popup hasn't been created, or it has but it isn't currently open, open the popup.\r\n        if (!this._componentRef || (this._componentRef && !this.popup.isOpen)) {\r\n            return this.open();\r\n        }\r\n\r\n        // O'wise, close it.\r\n        return this.close();\r\n    }\r\n\r\n    @HostListener(\"mouseenter\")\r\n    private onMouseEnter():void {\r\n        if (this.popup.config.trigger === PopupTrigger.Hover) {\r\n            this.openDelayed();\r\n        }\r\n    }\r\n\r\n    @HostListener(\"mouseleave\")\r\n    private onMouseLeave():void {\r\n        if (this.popup.config.trigger === PopupTrigger.Hover) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    @HostListener(\"click\")\r\n    private onClick():void {\r\n        if (this.popup.config.trigger === PopupTrigger.Click ||\r\n            this.popup.config.trigger === PopupTrigger.OutsideClick) {\r\n\r\n            // Repeated clicks require a toggle, rather than just opening the popup each time.\r\n            this.toggleDelayed();\r\n        } else if (this.popup.config.trigger === PopupTrigger.Focus &&\r\n                   (!this._componentRef || (this._componentRef && !this.popup.isOpen))) {\r\n            // Repeated clicks with a focus trigger requires an open (as focus isn't ever lost on repeated click).\r\n            this.openDelayed();\r\n        }\r\n    }\r\n\r\n    @HostListener(\"document:click\", [\"$event\"])\r\n    public onDocumentClick(e:MouseEvent):void {\r\n        // If the popup trigger is outside click,\r\n        if (this._componentRef && this.popup.config.trigger === PopupTrigger.OutsideClick) {\r\n            const target = e.target as Element;\r\n            // Close the popup if the click is outside of the popup element.\r\n            if (!(this._element.nativeElement as Element).contains(target)) {\r\n                this.close();\r\n            }\r\n        }\r\n    }\r\n\r\n    @HostListener(\"focusin\")\r\n    private onFocusIn():void {\r\n        if (this.popup.config.trigger === PopupTrigger.Focus) {\r\n            this.openDelayed();\r\n        }\r\n    }\r\n\r\n    @HostListener(\"focusout\")\r\n    private onFocusOut():void {\r\n        if (this.popup.config.trigger === PopupTrigger.Focus) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    public ngOnDestroy():void {\r\n        this._componentRef.destroy();\r\n    }\r\n}\r\n"]}